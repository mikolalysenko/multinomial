"use strict"

var test = require('tap').test
var multi = require("../multi.js")

test("multinomial", function(t) {

  t.equals(multi(0, 5), 1)
  t.equals(multi(1, 4), 5)
  
  t.equals(multi(7, 4, 2), 25740)
  t.equals(multi(9, 8, 4), 145495350)

  t.end()
})

test("binomial coefficients", function(t) {
  var ref = [[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],
             [1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],
             [1,8,28,56,70,56,28,8,1],[1,9,36,84,126,126,84,36,9,1],[1,10,45,120,210,252,210,120,45,10,1]]

  for(var n=0; n<ref.length; n++) {
    t.deepEqual(multi.binomials(n), ref[n], "n = " + n)
  }

  t.end()
})

test("multinomial coefficients", function(t) {
  var counts = [[[0,0]],[[1,0],[0,1]],[[2,0],[1,1],[0,2]],[[3,0],[2,1],[1,2],[0,3]],[[4,0],[3,1],[2,2],[1,3],[0,4]],
                [[5,0],[4,1],[3,2],[2,3],[1,4],[0,5]],[[6,0],[5,1],[4,2],[3,3],[2,4],[1,5],[0,6]],[[7,0],[6,1],[5,2],[4,3],[3,4],[2,5],[1,6],[0,7]],
                [[8,0],[7,1],[6,2],[5,3],[4,4],[3,5],[2,6],[1,7],[0,8]],[[9,0],[8,1],[7,2],[6,3],[5,4],[4,5],[3,6],[2,7],[1,8],[0,9]],
                [[10,0],[9,1],[8,2],[7,3],[6,4],[5,5],[4,6],[3,7],[2,8],[1,9],[0,10]],
                [[0]],[[1]],[[2]],[[3]],[[4]],
                [[0,0,0]],[[0,0,0,0]],[[1,0,0],[0,1,0],[0,0,1]],
                [[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],
                [[2,0,0],[1,1,0],[1,0,1],[0,2,0],[0,1,1],[0,0,2]],
                [[2,0,0,0],[1,1,0,0],[1,0,1,0],[1,0,0,1],[0,2,0,0],[0,1,1,0],[0,1,0,1],[0,0,2,0],[0,0,1,1],[0,0,0,2]],
                [[3,0,0],[2,1,0],[2,0,1],[1,2,0],[1,1,1],[1,0,2],[0,3,0],[0,2,1],[0,1,2],[0,0,3]],
                [[3,0,0,0],[2,1,0,0],[2,0,1,0],[2,0,0,1],[1,2,0,0],[1,1,1,0],[1,1,0,1],[1,0,2,0],[1,0,1,1],[1,0,0,2],
                 [0,3,0,0],[0,2,1,0],[0,2,0,1],[0,1,2,0],[0,1,1,1],[0,1,0,2],[0,0,3,0],[0,0,2,1],[0,0,1,2],[0,0,0,3]],
                [[4,0,0],[3,1,0],[3,0,1],[2,2,0],[2,1,1],[2,0,2],[1,3,0],[1,2,1],[1,1,2],[1,0,3],[0,4,0],[0,3,1],[0,2,2],[0,1,3],[0,0,4]],
                [[4,0,0,0],[3,1,0,0],[3,0,1,0],[3,0,0,1],[2,2,0,0],[2,1,1,0],[2,1,0,1],[2,0,2,0],[2,0,1,1],[2,0,0,2],[1,3,0,0],
                 [1,2,1,0],[1,2,0,1],[1,1,2,0],[1,1,1,1],[1,1,0,2],[1,0,3,0],[1,0,2,1],[1,0,1,2],[1,0,0,3],[0,4,0,0],[0,3,1,0],
                 [0,3,0,1],[0,2,2,0],[0,2,1,1],[0,2,0,2],[0,1,3,0],[0,1,2,1],[0,1,1,2],[0,1,0,3],[0,0,4,0],[0,0,3,1],[0,0,2,2],[0,0,1,3],[0,0,0,4]]];
  var coefs = [[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],
               [1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],
               [1,8,28,56,70,56,28,8,1],[1,9,36,84,126,126,84,36,9,1],[1,10,45,120,210,252,210,120,45,10,1],
               [1],[1],[1],[1],[1],
               [1],[1],[1,1,1],[1,1,1,1],[1,2,2,1,2,1],[1,2,2,2,1,2,2,1,2,1],
               [1,3,3,3,6,3,1,3,3,1],[1,3,3,3,3,6,6,3,6,3,1,3,3,3,6,3,1,3,3,1],[1,4,4,6,12,6,4,12,12,4,1,4,6,4,1],
               [1,4,4,4,6,12,12,6,12,6,4,12,12,12,24,12,4,12,12,4,1,4,4,6,12,6,4,12,12,4,1,4,6,4,1]]

  var n, d, result
  for(var i=0; i<counts.length; i++) {
    n = counts[i][0].reduce(function(a,b){return a+b})
    d = counts[i][0].length
    result = multi.multinomials(n, d)
    t.deepEqual(result.counts, counts[i], "n = " + n + ", d = " + d + " (counts)")
    t.deepEqual(result.coefs, coefs[i], "n = " + n + ", d = " + d + " (coefs)")
  }

  t.end()
})
